---
parent: Specification
nav_order: 1
---

# Templating

Each section can be (partially) generated by using jinja2 templating strings
(j2-strings), so every string in the specs YAML will be rendered and the result
replaces that j2-string (so you can generate all data types with your j2-string,
not only strings).

{: .warning}
The specs file is **first** parsed as a YAML file, so no matter what you do
within your j2-strings, the file must be valid YAML.

Here's an example:

{% raw %}
```yaml
types:
  - name: my_type
    title: "{{ my_fancy_type_title_lookup_function() }}"
```
{% endraw %}

{% raw %}
{: .note}
You will always need to start the string with `"{{"` (or `"{%"`) to have
it parsed as a j2-string. You will later see j2-string that do not have this
format and are used plainly (like `yac_if: new.data.blub|default('') == 'hi'`).
This is due to the fact, that some j2-strings should not be parsed when the
specs section is loaded but (sometimes even multiple times) at runtime.
{% endraw %}

## Builtins

Within j2-strings, you can use all
[builtin](https://jinja.palletsprojects.com/en/stable/templates) `functions`,
`tests` and `filters`.

### YAC Extensions

YAC provides some builtin functionality that extends the jinja2 defaults. You
will find them in the respective [Plugin](../../plugins) directory, where you
can also add your own extensions.

A special constant is `omit`, which will cause the key where it is set to be
removed completely.

## Variables

The variables you can use in j2-strings depend on the context. Here's a matrix
of all variables and their scope:

| Variable\\Section | `request` | `types` | `repo.details`  | `types[].name_generator`  | `types[].actions[].details` | `types[].logs[].details`  | `roles` | `sets`  | `schema`  |
|:------------------|:---------:|:-------:|:---------------:|:-------------------------:|:---------------------------:|:-------------------------:|:-------:|:-------:|:---------:|
| `context`         |           |         |                 |                           |                             |                           |         |         |     X     |
| `loc`             |     X     |    X    |        X        |             X             |              X              |             X             |    X    |    X    |     X     |
| `env`             |     X     |    X    |                 |             X             |              X              |             X             |    X    |    X    |     X     |
| `request.ip`      |           |    X    |                 |             X             |              X              |             X             |    X    |    X    |     X     |
| `request.headers` |           |    X    |                 |             X             |              X              |             X             |    X    |    X    |     X     |
| `user.name`       |           |    X    |                 |             X             |              X              |             X             |    X    |    X    |     X     |
| `user.email`      |           |    X    |                 |             X             |              X              |             X             |    X    |    X    |     X     |
| `user.full_name`  |           |    X    |                 |             X             |              X              |             X             |    X    |    X    |     X     |
| `user.token`      |           |    X    |                 |             X             |              X              |             X             |    X    |    X    |     X     |
| `user.perms`      |           |         |                 |                           |                             |                           |         |         |     X     |
| `operation`       |           |         |                 |             X             |              X              |                           |    X    |    X    |     X     |
| `actions`         |           |         |                 |             X             |              X              |                           |    X    |    X    |     X     |
| `type`            |           |         |                 |                           |                             |                           |    X    |    X    |     X     |
| `old.name`        |           |         |                 |                           |              X              |             X             |    X    |    X    |     X     |
| `old.data`        |           |         |                 |                           |                             |                           |    X    |    X    |     X     |
| `old.list`        |           |         |                 |             X             |                             |                           |         |         |           |
| `new.name`        |           |         |                 |                           |              X              |                           |    X    |    X    |     X     |
| `new.data`        |           |         |                 |             X             |                             |                           |         |         |     X     |
| `name`            |           |         |        X        |                           |              X              |             X             |    X    |    X    |     X     |
| *Plugin specific* |           |         |        X        |                           |              X              |             X             |         |         |           |

### Variable `context`

The variable `context` is an `object` and contains the unmodified content of the
according specs [section](file/context).

### Variable `loc`

This contains a string that represents the location of this jinja2 context
relative to the parsed root in the specs (= each row in the table). The root is
represented as `#`. (For example: `#/properties/system_type`)

### Variable `env`

Is an `object` that contains all custom environment variables provided to the
application. For example the env variable `YAC_ENV__MY_CUSTOM_VAR="hello World"`
is available as `env.my_custom_var` with the value `hello World` in j2-strings.
This is mainly meant for secrets or configuration you don't want to put into the
specs file but rather inject them at runtime.

### Variable `request`

This contains data about the current request. `request.ip` is the remote IP and
`request.headers` is a dictionary of custom headers defined in the spec section
[request](./request.md).

### Variable `user`

Contains some details about the user making the current request.

The key `perms` contains the permissions the user has for the current operation,
rendered from the `roles` and `sets`.

{: .note}
The data in `user.token` is not standardized and just reflects what the Open ID
Connect identity provider sends within the token.

### Variable `operation`

Defines the the operation the current request is doing, which can be one of:
`read`, `create`, `change`, `delete` or `arbitrary` (which means only an action
is being executed)

### Variable `actions`

The list of actions that are requested to be executed alongside the current
request. (For `operation == "arbitrary"` this is actually the only thing done.)

{: .important}
This list may be incomplete due to actions defined with the `force` attribute
(which will add them implicitly if not provided).

### Variable `type`

The type of the entity that the current request refers to.

### Variable `old`

Contains the `name` and `data` of the already existing entity in the repository
the current request is referring to.

Addititonally, `perms` contains all permission flags the current user has on
this entity.

### Variable `new`

This is very similar to `old` but contains the `name` and `data` of a request
to create/change that entity. So `new.name` may be a non-existing entity and
`new.data` contains unverified data that not yet is stored in the repository.

(`new.data` is acutally what will be validated with the schema after generating
the schema.)

### Variable `name`

This is the same as `old.name` or `new.name` depending on the context. This
should usually be a good default to use but note the following special cases:

  - If an entity is being renamed, it contains the new name!
  - If an entity is being copied or linked, it contains the new name!

### *Plugin specific* variables

Plugins may add specific variables. Check the respective [Plugin](../../plugins)
for details.
